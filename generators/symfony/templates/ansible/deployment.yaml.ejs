- hosts: server
  tasks:
    - import_role:
        name: build
      delegate_to: localhost
    - import_role:
        name: deploy
      vars:
        path: /home/<%= packageName %>
        artifact_path: <%= packageName %>.tar.gz
        before_finalize:
          - ./bin/console doctrine:migrations:migrate --no-interaction
      environment: '{{ <%= packageName.replace('-', '_') %>_env }}'
  vars:
    job_name: <%= packageName %>-archive
    repository_name: <%= repositoryName %>
  vars_files:
    - vars/circleci.yaml
    - vars/github.yaml
  tags:
    - <%= packageName %>
